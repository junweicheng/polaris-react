containers:
  default:
    docker: gcr.io/shopify-docker-images/apps/production/web-platform-ci-node:10.11.0-yarn-1.12.3

shared:
  build: &build
    label: 'Build'
    container: default
    timeout: 5m
    dependencies:
      - yarn
    run:
      - yarn run build
  build-web: &build-web
    label: 'Build web'
    container: default
    timeout: 15m
    dependencies:
      - yarn
    run:
      - ./move-directory-in-ci.sh
      - .polaris-react/build-consumer.sh web
  build-styleguide: &build-styleguide
    label: 'Build styleguide'
    container: default
    timeout: 15m
    dependencies:
      - yarn
    run:
      - ./move-directory-in-ci.sh
      - .polaris-react/build-consumer.sh polaris-styleguide

steps:
  - <<: *build
  - wait
  - <<: *build-styleguide
  - <<: *build-web
